# 🚀 抖音上传一键启动使用说明

## 📋 功能特性

- ✅ **一键启动** - 容器启动时自动运行app.py
- ✅ **自动重启** - 服务异常时自动重启
- ✅ **健康检查** - 自动监控服务状态
- ✅ **日志管理** - 实时查看应用日志
- ✅ **完整管理** - 启动、停止、重启、进入容器等

## 🎯 快速开始

### 1. 给脚本执行权限
```bash
chmod +x start.sh
```

### 2. 一键启动服务
```bash
./start.sh start
```

启动后会自动：
- 创建必要目录（cookie、videos、downloads、database、logs）
- 启动Docker容器
- 自动运行app.py
- 检查服务健康状态
- 显示访问地址：http://localhost:5000

## 📚 所有命令

### 基础操作
```bash
# 启动服务
./start.sh start

# 停止服务
./start.sh stop

# 重启服务
./start.sh restart

# 查看状态
./start.sh status
```

### 日志和调试
```bash
# 查看实时日志
./start.sh logs

# 检查健康状态
./start.sh health

# 进入容器
./start.sh enter
```

### 高级操作
```bash
# 更新镜像
./start.sh update

# 清理所有资源
./start.sh clean

# 显示帮助
./start.sh help
```

## 🔧 配置文件说明

### docker-compose-auto.yml
- **自动启动**: 容器启动时直接运行 `python app.py`
- **端口映射**: 5000端口用于Web界面
- **健康检查**: 每30秒检查一次服务状态
- **自动重启**: 服务异常时自动重启

### 目录挂载
```
宿主机目录          →  容器内目录
./cookie           →  /workspace/cookie
./videos           →  /workspace/videos
./downloads        →  /workspace/downloads
./database         →  /workspace/database
./logs             →  /workspace/logs
```

## 📊 服务监控

### 健康检查
脚本会自动检查：
- ✅ Docker容器是否运行
- ✅ Web服务是否响应
- ✅ 端口是否正常监听

### 状态查看
```bash
# 查看详细状态
./start.sh status

# 输出示例：
# 📊 服务状态:
# Name: douyin-upload-auto
# State: Up 5 minutes
# Ports: 0.0.0.0:5000->5000/tcp
```

## 🐛 故障排除

### 问题1：服务启动失败
```bash
# 查看详细日志
./start.sh logs

# 检查Docker权限
sudo ./start.sh start
```

### 问题2：Web界面无法访问
```bash
# 检查服务健康状态
./start.sh health

# 等待服务完全启动
sleep 10
./start.sh health
```

### 问题3：端口被占用
```bash
# 检查端口占用
netstat -tuln | grep 5000

# 停止占用端口的进程或修改配置文件中的端口
```

### 问题4：容器无法启动
```bash
# 查看Docker状态
docker info

# 重新构建镜像
./start.sh update
```

## 📁 文件结构

完整的项目结构：
```
douyin-upload/
├── start.sh                    # 一键启动脚本
├── docker-compose-auto.yml     # 自动启动配置
├── Dockerfile                  # 镜像构建文件
├── app.py                      # 主应用程序
├── main.py                     # 核心逻辑
├── requirements.txt            # Python依赖
├── cookie/                     # Cookie存储目录
├── videos/                     # 视频文件目录
├── downloads/                  # 下载目录
├── database/                   # 数据库目录
├── logs/                       # 日志目录
└── docs/                       # 文档目录
```

## 🎯 使用场景

### 开发调试
```bash
# 启动服务
./start.sh start

# 查看实时日志
./start.sh logs

# 进入容器调试
./start.sh enter
```

### 生产部署
```bash
# 启动服务（后台运行）
./start.sh start

# 定期检查状态
./start.sh status

# 查看日志
./start.sh logs
```

### 更新维护
```bash
# 更新代码后重新构建
./start.sh update

# 重启服务
./start.sh restart

# 清理旧资源
./start.sh clean
```

## ⚡ 性能优化

### 自动重启策略
- **unless-stopped**: 除非手动停止，否则总是重启
- **健康检查**: 30秒检查一次，失败3次后重启

### 资源监控
```bash
# 查看容器资源使用
docker stats douyin-upload-auto

# 查看日志大小
du -sh logs/
```

## 🔐 安全注意事项

1. **端口安全**: 确保5000端口防火墙设置正确
2. **文件权限**: 定期检查挂载目录权限
3. **日志清理**: 定期清理logs目录避免磁盘满
4. **镜像更新**: 定期更新基础镜像和依赖

## 💡 最佳实践

1. **定期备份**: 备份cookie和database目录
2. **监控日志**: 设置日志轮转避免磁盘占满
3. **健康检查**: 使用外部监控工具监控服务状态
4. **版本管理**: 为镜像打标签管理不同版本

## 🎉 完成！

现在您可以使用 `./start.sh start` 一键启动完整的抖音上传服务！

访问地址：http://localhost:5000 