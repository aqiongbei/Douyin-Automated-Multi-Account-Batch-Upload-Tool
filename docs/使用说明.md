# Playwright Docker æŠ–éŸ³ä¸Šä¼ ç¯å¢ƒä½¿ç”¨æŒ‡å—

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

### 1. ç¡®ä¿Dockerå·²å®‰è£…
```bash
# æ£€æŸ¥Dockeræ˜¯å¦å®‰è£…
docker --version
docker-compose --version
```

### 2. åˆ›å»ºå¿…è¦ç›®å½•
```bash
# åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºç›®å½•ï¼ˆé‡è¦ï¼ï¼‰
mkdir -p /vol1/1000/docker/playwright-browser
mkdir -p /vol1/1000/docker/playwright-browser/cookie
mkdir -p /vol1/1000/docker/playwright-browser/videos
```

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨Dockerå®¹å™¨

### 1.1 å¯åŠ¨å®¹å™¨
```bash
# åœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ
docker-compose up -d
```

### 1.2 éªŒè¯å®¹å™¨è¿è¡Œ
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# CONTAINER ID   IMAGE                                          PORTS                    NAMES
# xxxxxxxxxx     mcr.microsoft.com/playwright/python:v1.40.0   0.0.0.0:4701->8080/tcp   playwright-browser
```

### 1.3 ç¡®è®¤ç«¯å£è®¿é—®
è®¿é—® http://669900.top:4701 ç¡®è®¤å®¹å™¨å¯è®¿é—®

## ğŸ”§ ç¬¬äºŒæ­¥ï¼šå®‰è£…ç¯å¢ƒä¾èµ–

### 2.1 è¿›å…¥å®¹å™¨
```bash
# è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨
docker exec -it playwright-browser bash

# è¿›å…¥ååº”è¯¥çœ‹åˆ°å®¹å™¨å†…å‘½ä»¤è¡Œï¼šroot@xxxxxxxxxx:/workspace#
```

### 2.2 å¿«é€Ÿå®‰è£…ï¼ˆæ¨èæ–¹å¼ï¼‰
```bash
# åœ¨å®¹å™¨å†…æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

# ç¡®è®¤åœ¨å·¥ä½œç›®å½•
pwd
# è¾“å‡ºåº”è¯¥æ˜¯ï¼š/workspace

# è¿è¡Œå¿«é€Ÿå®‰è£…è„šæœ¬
chmod +x å¿«é€Ÿå®‰è£….sh
./å¿«é€Ÿå®‰è£….sh

# ç­‰å¾…å®‰è£…å®Œæˆï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰
```

### 2.3 æ‰‹åŠ¨å®‰è£…ï¼ˆå¤‡é€‰æ–¹å¼ï¼‰
å¦‚æœå¿«é€Ÿå®‰è£…è„šæœ¬ä¸å·¥ä½œï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

```bash
# é…ç½®pipå›½å†…æº
mkdir -p ~/.pip
cat > ~/.pip/pip.conf << EOF
[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
trusted-host = pypi.tuna.tsinghua.edu.cn
timeout = 120
EOF

# å®‰è£…åŸºç¡€ä¾èµ–
pip install playwright flask requests asyncio websockets aiohttp

# è®¾ç½®playwrightä¸‹è½½é•œåƒ
export PLAYWRIGHT_DOWNLOAD_HOST=https://npmmirror.com/mirrors/playwright

# å®‰è£…æµè§ˆå™¨
python -m playwright install chromium
```

### 2.4 éªŒè¯å®‰è£…
```bash
# æµ‹è¯•playwrightæ˜¯å¦å®‰è£…æˆåŠŸ
python -c "
from playwright.sync_api import sync_playwright
print('Playwrightå®‰è£…æˆåŠŸ!')
"

# å¦‚æœçœ‹åˆ°"Playwrightå®‰è£…æˆåŠŸ!"è¯´æ˜ç¯å¢ƒå‡†å¤‡å®Œæ¯•
```

## ğŸ“ ç¬¬ä¸‰æ­¥ï¼šå‡†å¤‡ä»£ç æ–‡ä»¶

### 3.1 å¤åˆ¶ä»£ç åˆ°å®¹å™¨
**æ–¹æ³•Aï¼šé€šè¿‡æŒ‚è½½ç›®å½•**
```bash
# åœ¨å®¿ä¸»æœºä¸Šï¼Œå°†æ‚¨çš„ä»£ç å¤åˆ¶åˆ°æŒ‚è½½ç›®å½•
cp -r /path/to/your/douyin_code/* /vol1/1000/docker/playwright-browser/

# æ–‡ä»¶ä¼šè‡ªåŠ¨åŒæ­¥åˆ°å®¹å™¨çš„/workspaceç›®å½•
```

**æ–¹æ³•Bï¼šç›´æ¥åœ¨å®¹å™¨å†…æ“ä½œ**
```bash
# åœ¨å®¹å™¨å†…ï¼Œå¦‚æœæ‚¨çš„ä»£ç åœ¨GitHubç­‰åœ°æ–¹
git clone https://github.com/your/douyin_project.git
# æˆ–ä½¿ç”¨å…¶ä»–æ–¹å¼è·å–ä»£ç 
```

### 3.2 ç¡®è®¤æ–‡ä»¶åŒæ­¥
```bash
# åœ¨å®¹å™¨å†…æ£€æŸ¥æ–‡ä»¶
ls -la /workspace
ls -la /workspace/cookie
ls -la /workspace/videos

# åº”è¯¥çœ‹åˆ°æ‚¨çš„ä»£ç æ–‡ä»¶
```

## ğŸµ ç¬¬å››æ­¥ï¼šè¿è¡ŒæŠ–éŸ³ä¸Šä¼ 

### 4.1 æµ‹è¯•ç¯å¢ƒ
```bash
# åœ¨å®¹å™¨å†…æµ‹è¯•åŸºæœ¬åŠŸèƒ½
python -c "
from playwright.sync_api import sync_playwright
with sync_playwright() as p:
    browser = p.chromium.launch(headless=True)
    page = browser.new_page()
    page.goto('https://www.douyin.com')
    print('è®¿é—®æŠ–éŸ³æˆåŠŸ!')
    browser.close()
"
```

### 4.2 è¿è¡Œæ‚¨çš„è„šæœ¬
```bash
# è¿è¡Œæ‚¨çš„ä¸»ç¨‹åºï¼ˆå‡è®¾æ˜¯app.pyï¼‰
python app.py

# æˆ–è¿è¡Œå…¶ä»–è„šæœ¬
python your_script.py
```

### 4.3 æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
```bash
# å¦‚æœéœ€è¦æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
python app.py 2>&1 | tee upload.log

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æŸ¥çœ‹æ—¥å¿—
docker exec -it playwright-browser tail -f upload.log
```

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šå®¹å™¨æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥å®¹å™¨æ—¥å¿—
docker logs playwright-browser

# é‡æ–°å¯åŠ¨
docker-compose restart
```

### é—®é¢˜2ï¼šæ— æ³•è®¿é—®æŒ‚è½½ç›®å½•
```bash
# æ£€æŸ¥ç›®å½•æƒé™
ls -la /vol1/1000/docker/playwright-browser/

# å¦‚æœæƒé™ä¸å¯¹ï¼Œä¿®æ”¹æƒé™
chmod -R 755 /vol1/1000/docker/playwright-browser/
```

### é—®é¢˜3ï¼špipå®‰è£…å¤±è´¥
```bash
# æ‰‹åŠ¨æŒ‡å®šé•œåƒæº
pip install åŒ…å -i https://pypi.tuna.tsinghua.edu.cn/simple

# æˆ–ä½¿ç”¨å…¶ä»–é•œåƒæº
pip install åŒ…å -i https://pypi.mirrors.ustc.edu.cn/simple/
```

### é—®é¢˜4ï¼šplaywrightæµè§ˆå™¨ä¸‹è½½å¤±è´¥
```bash
# é‡æ–°å®‰è£…æµè§ˆå™¨
python -m playwright install chromium --force

# æˆ–ä½¿ç”¨ä¸åŒçš„ä¸‹è½½æº
export PLAYWRIGHT_DOWNLOAD_HOST=https://registry.npmmirror.com/-/binary/playwright/
python -m playwright install chromium
```

## ğŸ“š å¸¸ç”¨å‘½ä»¤å‚è€ƒ

```bash
# è¿›å…¥å®¹å™¨
docker exec -it playwright-browser bash

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps

# é‡å¯å®¹å™¨
docker-compose restart

# åœæ­¢å®¹å™¨
docker-compose down

# å¯åŠ¨å®¹å™¨
docker-compose up -d

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs playwright-browser -f

# åœ¨å®¹å™¨å†…è¿è¡Œå•æ¡å‘½ä»¤
docker exec -it playwright-browser python your_script.py
```

## ğŸ“‚ ç›®å½•ç»“æ„è¯´æ˜

```
å®¿ä¸»æœºç›®å½•                          å®¹å™¨å†…ç›®å½•
/vol1/1000/docker/playwright-browser  â†’  /workspace
â”œâ”€â”€ cookie/                           â†’  /workspace/cookie/
â”œâ”€â”€ videos/                           â†’  /workspace/videos/
â”œâ”€â”€ app.py                           â†’  /workspace/app.py
â”œâ”€â”€ main.py                          â†’  /workspace/main.py
â””â”€â”€ utils/                           â†’  /workspace/utils/
```

## âœ… æˆåŠŸæ ‡å¿—

å½“æ‚¨çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºæ—¶ï¼Œè¯´æ˜ç¯å¢ƒæ­å»ºæˆåŠŸï¼š
1. âœ… å®¹å™¨æ­£å¸¸è¿è¡Œï¼š`docker ps` æ˜¾ç¤ºå®¹å™¨çŠ¶æ€ä¸º `Up`
2. âœ… å¯ä»¥è¿›å…¥å®¹å™¨ï¼š`docker exec -it playwright-browser bash` æˆåŠŸ
3. âœ… Playwrightæ­£å¸¸ï¼šè¿è¡Œæµ‹è¯•ä»£ç æ— æŠ¥é”™
4. âœ… æ–‡ä»¶åŒæ­¥æ­£å¸¸ï¼šå®¹å™¨å†…å¯ä»¥çœ‹åˆ°æ‚¨çš„ä»£ç æ–‡ä»¶
5. âœ… è„šæœ¬è¿è¡Œæ­£å¸¸ï¼š`python app.py` å¯ä»¥æ­£å¸¸å¯åŠ¨ 