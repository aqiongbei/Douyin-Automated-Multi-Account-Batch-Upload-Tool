# 🔧 浏览器视图调试指南

## 问题描述
浏览器实时视图弹窗没有显示截图画面，只显示"正在启动浏览器..."的覆盖层。

## 🛠️ 调试工具

我已经为您添加了专门的调试工具，可以帮助诊断问题。

### 使用方法

1. **打开浏览器开发者工具**
   - 按 `F12` 或右键选择"检查"
   - 切换到 `Console` 标签

2. **运行调试命令**

```javascript
// 完整调试流程
runFullDebug()

// 或者分步调试：
testWebSocketConnection()  // 测试WebSocket连接
testBrowserViewModal()     // 测试模态框
testMockScreenshot()       // 测试截图显示
simulateScreenshotMessage() // 模拟截图消息

// 快速修复
quickFix()
```

## 🔍 常见问题排查

### 1. WebSocket连接问题

**症状**: 控制台出现连接错误
**解决**: 
```javascript
testWebSocketConnection()
```
检查输出是否显示"✅ WebSocket连接成功"

### 2. Socket.IO库加载问题

**症状**: 控制台显示"Socket.IO库未加载"
**解决**: 
- 检查网络连接
- 刷新页面重试
- 检查CDN是否可访问

### 3. 模态框元素缺失

**症状**: 控制台显示"找不到browser-view-modal元素"
**解决**:
```javascript
testBrowserViewModal()
```

### 4. 会话ID不匹配

**症状**: 有WebSocket消息但截图不显示
**解决**:
```javascript
// 检查当前会话ID
console.log('当前会话ID:', window.currentBrowserSession)

// 模拟正确的截图消息
simulateScreenshotMessage()
```

## 🚀 重新启动服务

如果需要重新启动Docker服务应用代码修改：

### Windows (PowerShell)
```powershell
# 如果有WSL或Git Bash
bash -c "docker stop douyin-upload-safe && docker compose -f docker-compose-safe.yml up -d"

# 或者使用批处理文件
.\start.bat stop
.\start.bat
```

### Linux/macOS
```bash
./start.sh stop
./start.sh safe
```

## 📝 日志分析

### 后端日志关键信息
查找以下关键日志：
- `🔗 WebSocket客户端连接成功`
- `📸 发送截图到客户端`
- `🧪 收到测试消息`

### 前端控制台关键信息
查找以下关键信息：
- `✅ WebSocket连接成功`
- `✅ 模态框已显示`
- `✅ 测试图片已加载`

## 🔄 完整的重新生成Cookie流程

1. **清理旧会话**
```javascript
quickFix()
```

2. **重新生成Cookie**
   - 输入Cookie名称
   - 点击"生成新Cookie"
   - 观察控制台输出

3. **检查浏览器视图**
   - 模态框应该自动打开
   - 应该显示"浏览器已启动"状态
   - 几秒后应该看到截图

## 🆘 如果问题持续存在

1. **收集信息**:
   - 运行 `runFullDebug()` 并截图控制台输出
   - 检查浏览器网络标签是否有WebSocket连接
   - 查看后端服务日志

2. **尝试手动测试**:
```javascript
// 手动显示模态框
document.getElementById('browser-view-modal').classList.remove('hidden')

// 手动设置测试图片
document.getElementById('browser-screenshot').src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=='
```

3. **重置所有状态**:
```javascript
// 完全重置
window.location.reload()
```

## 📞 技术支持

如果以上步骤都无法解决问题，请提供：
1. 控制台完整输出
2. 网络标签的WebSocket连接状态
3. 后端服务日志
4. 浏览器版本信息

这样我可以提供更具体的解决方案。 